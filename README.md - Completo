# ğŸ” Sistema de Roles y Permisos

## ğŸ“‹ DescripciÃ³n General

El sistema ahora cuenta con **2 tipos de usuarios** con diferentes niveles de acceso:

### ğŸ‘¥ **OPERADORES** (4 usuarios)
Personal de garita con acceso limitado a operaciones bÃ¡sicas.

### ğŸ” **ADMINISTRADORES** (2 usuarios)
Personal de supervisiÃ³n con acceso completo incluyendo reportes y auditorÃ­a.

---

## ğŸ‘¥ Usuarios Operadores

### Credenciales
| Usuario | ContraseÃ±a | Nombre Completo |
|---------|------------|-----------------|
| operador1 | 1234 | Juan PÃ©rez |
| operador2 | 1234 | MarÃ­a GarcÃ­a |
| operador3 | 1234 | Carlos LÃ³pez |
| operador4 | 1234 | Ana MartÃ­nez |

### Permisos de Operadores
âœ… **Pueden acceder a:**
- âœ“ Ingreso de vehÃ­culos
- âœ“ Salida de vehÃ­culos (escaneo QR)
- âœ“ GestiÃ³n de clientes mensuales
- âœ“ Estado actual del estacionamiento

âŒ **NO pueden acceder a:**
- âœ— Reportes diarios
- âœ— Panel de auditorÃ­a
- âœ— EstadÃ­sticas avanzadas
- âœ— Descargas de backups

---

## ğŸ” Usuarios Administradores

### Credenciales
| Usuario | ContraseÃ±a | Nombre Completo |
|---------|------------|-----------------|
| admin1 | admin123 | Supervisor General |
| admin2 | admin123 | Gerente de Operaciones |

### Permisos de Administradores
âœ… **Acceso completo a:**
- âœ“ Todas las funciones de operadores
- âœ“ **Reportes diarios** con estadÃ­sticas
- âœ“ **Panel de auditorÃ­a** con bÃºsqueda avanzada
- âœ“ Descarga de reportes (JSON, CSV, TXT)
- âœ“ VisualizaciÃ³n de backups
- âœ“ EstadÃ­sticas histÃ³ricas (semana, mes, total)

---

## ğŸš€ Pasos para Actualizar el Sistema

### 1. Reinicializar la Base de Datos
```bash
python init_db.py
```

Este comando:
- âœ“ Elimina la base de datos anterior
- âœ“ Crea las nuevas tablas con el campo `role`
- âœ“ Crea 4 usuarios operadores
- âœ“ Crea 2 usuarios administradores
- âœ“ Crea clientes mensuales de ejemplo

### 2. Verificar los Cambios
AsegÃºrate de que estos archivos estÃ©n actualizados:
- âœ“ `app/models/models.py` - Modelo con campo `role`
- âœ“ `app/routes.py` - Rutas protegidas con `@admin_required`
- âœ“ `app/templates/base.html` - MenÃº con roles
- âœ“ `init_db.py` - Script con nuevos usuarios

### 3. Iniciar el Sistema
```bash
python run.py
```

---

## ğŸ¯ CaracterÃ­sticas de Seguridad

### ProtecciÃ³n de Rutas
Las rutas administrativas estÃ¡n protegidas con el decorador `@admin_required`:
- Si un operador intenta acceder, es redirigido al inicio
- Se muestra un mensaje de "Acceso denegado"

### Interfaz Adaptativa
- **Operadores**: Solo ven opciones bÃ¡sicas en el menÃº
- **Administradores**: Ven un menÃº desplegable "Admin" con badge rojo

### Visual Indicators
```
OPERADORES â†’ Badge azul "OPERADOR"
ADMINISTRADORES â†’ Badge rojo "ADMIN"
```

---

## ğŸ“Š Diferencias en el MenÃº

### MenÃº para OPERADORES
```
ğŸ  Inicio
ğŸ“¥ Ingreso
ğŸ“¤ Salida  
ğŸ’³ Mensuales
ğŸ• Estado
```

### MenÃº para ADMINISTRADORES
```
ğŸ  Inicio
ğŸ“¥ Ingreso
ğŸ“¤ Salida
ğŸ’³ Mensuales
ğŸ• Estado
ğŸ” Admin â–¼
   â”œâ”€ ğŸ“Š Reportes
   â””â”€ ğŸ›¡ï¸ AuditorÃ­a
```

---

## ğŸ”„ MigraciÃ³n desde VersiÃ³n Anterior

Si ya tenÃ­as usuarios creados:

1. **Hacer backup de la base de datos actual:**
   ```bash
   copy app.db app.db.backup
   ```

2. **Reinicializar:**
   ```bash
   python init_db.py
   ```

3. **Si necesitas mantener datos:**
   - Los registros de vehÃ­culos se perderÃ¡n
   - Puedes restaurar manualmente desde el backup si es necesario

---

## ğŸ†˜ SoluciÃ³n de Problemas

### "No puedo ver Reportes/AuditorÃ­a"
**Causa:** EstÃ¡s logueado como operador  
**SoluciÃ³n:** Cerrar sesiÃ³n y entrar con credenciales de admin

### "Acceso denegado"
**Causa:** Intentas acceder a una ruta administrativa sin permisos  
**SoluciÃ³n:** Verifica que estÃ©s usando un usuario admin (admin1 o admin2)

### "Error de base de datos"
**Causa:** La BD no tiene el campo `role`  
**SoluciÃ³n:** Ejecutar `python init_db.py` para recrear las tablas

---

## ğŸ“± Pruebas Recomendadas

### Test de Operadores
1. Login con `operador1` / `1234`
2. Verificar que NO aparezca el menÃº "Admin"
3. Intentar acceder a `/reports` manualmente
4. Verificar mensaje de acceso denegado

### Test de Administradores
1. Login con `admin1` / `admin123`
2. Verificar badge "ADMIN" en navbar
3. Acceder a "Admin â†’ Reportes"
4. Acceder a "Admin â†’ AuditorÃ­a"
5. Verificar que todas las funciones funcionan

---

## ğŸ”§ PersonalizaciÃ³n

### Cambiar ContraseÃ±as
Editar en `init_db.py`:
```python
admins = [
    {'username': 'admin1', 'password': 'TU_NUEVA_CONTRASEÃ‘A', ...},
]
```

### Agregar MÃ¡s Usuarios
Editar en `init_db.py` y agregar al array correspondiente:
```python
operators.append({
    'username': 'operador5',
    'password': '1234',
    'name': 'Nuevo Operador',
    'role': 'operador'
})
```

---

## ğŸ“ Notas Importantes

âš ï¸ **Seguridad:**
- Cambia las contraseÃ±as por defecto en producciÃ³n
- Las contraseÃ±as se almacenan encriptadas con Werkzeug
- Los operadores NO pueden ver datos sensibles de auditorÃ­a

âœ… **Recomendaciones:**
- Usa contraseÃ±as fuertes para usuarios admin
- Revisa periÃ³dicamente los logs de auditorÃ­a
- Limita el acceso a credenciales administrativas

---

**Sistema actualizado con Ã©xito! ğŸ‰**

Para mÃ¡s informaciÃ³n, consulta el README principal del proyecto.